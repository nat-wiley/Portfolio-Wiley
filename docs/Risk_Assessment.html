<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Natalie Wiley - Risk Analysis for Transportation Emission Reduction Policies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Natalie Wiley</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghg-quantification-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHG Quantification Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghg-quantification-projects">    
        <li>
    <a class="dropdown-item" href="./Risk_Assessment.html">
 <span class="dropdown-text">Risk Analysis for Transportation Emission Reduction Policies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Electricity_emissions.html">
 <span class="dropdown-text">GA Electricity Emissions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Transportation_Emissions.html">
 <span class="dropdown-text">Transportation Emissions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Emission_Factors.html">
 <span class="dropdown-text">Custom Soil Emission Factors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Datagaps.html">
 <span class="dropdown-text">Addressing Data Gaps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Urea_Emissions.html">
 <span class="dropdown-text">Urea Emissions Estimation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SOC_change_montecarlo.html">
 <span class="dropdown-text">Soil Organic Carbon Stock Change</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./N2O_SoilEmissions.html">
 <span class="dropdown-text">Soil N2O Emissions-Regression Model</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./Geospatial.html">
 <span class="menu-text">Geospatial Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./COB_report.html">
 <span class="menu-text">Sustainability Assessments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Bison_storymap.html">
 <span class="menu-text">COP27 Presentation</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#r-script-to-assess-policy-option-1" id="toc-r-script-to-assess-policy-option-1" class="nav-link active" data-scroll-target="#r-script-to-assess-policy-option-1">R Script to assess policy option 1</a></li>
  <li><a href="#r-script-to-assess-policy-option-2" id="toc-r-script-to-assess-policy-option-2" class="nav-link" data-scroll-target="#r-script-to-assess-policy-option-2">R Script to assess policy option 2</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Risk Analysis for Transportation Emission Reduction Policies</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This project consisted of a risk analysis assessment for two hypothetical emission reduction plans for the city of Fort Collins, CO. This risk analysis quantified the amount of CO2e emissions reduced so I could show which policy plan achieved the most emissions reduced per tax dollar spent. In both hypothetical options, there was a budget of $500,000 to cut emissions from residential transportation.</p>
<p><strong>Policy option 1:</strong> Buy back vehicles that are trucks (not large commercial trucks), SUVs, or sedans, to have residents purchase an electric vehicle. This program is targeting older vehicles in the fleet for the buy-back program because the incentives are too low for owners to participate that have newer vehicles.</p>
<blockquote class="blockquote">
<p>The goal is to determine the amount of people that would participate in the buy back program from each population demographic (gender, education, age, reason for travel, vehicle type (SUV, sedan, truck).</p>
</blockquote>
<p><strong>Policy option 2:</strong> Small businesses are provided a $5,000 incentive and recognition as a climate smart company to support telecommuting by employees for two or more days of the week. This would reduce the amount of vehicle trips per week.</p>
<blockquote class="blockquote">
<p>The goal is to see how many people and how many businesses would likely participate in the program</p>
</blockquote>
<dl>
<dt>Results</dt>
<dd>
<p>The cost to reduce CO2e in both policy options were too high. The dollar amount cost per 1 tonne of emissions reduced was not worth investing $500,000 in. It is higher than the current social cost of carbon.</p>
</dd>
</dl>
<p><img src="images/image-1406013259.png" class="img-fluid" width="378"></p>
<p><img src="images/image-976492113.png" class="img-fluid" width="375"></p>
<section id="r-script-to-assess-policy-option-1" class="level3">
<h3 class="anchored" data-anchor-id="r-script-to-assess-policy-option-1">R Script to assess policy option 1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">####Import data contains weekly emission REDUCTIONS because we worked in Access to see how much emission reduction we </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">###would get if we switched people over to EVs</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ID is the ID number associated with each survey respondent </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">#### size = 108 = average of quotas for all three vehicles = mean (c(125,90,111))</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">### ASSUMPTIONS:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#weekend emissions: multiply weekly emissions by 33%  and add that as the weekend emission</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#example: to sample just SUVs instead of all cars, only have SUVs in your input table in Access (subset table to SUVs only, subset function can be done in R)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#make points in presentation about the risk and what we can get from the different programs</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Add packages</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>iseed <span class="ot">=</span> <span class="dv">34</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>nreps <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>buyback_sample_size <span class="ot">=</span> <span class="dv">108</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(iseed)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#import vehile emissions data</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>survey_data<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span> <span class="st">"InputData.csv"</span> , <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">fill=</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Covert the weekly emission reductions to annual</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>survey_data[,<span class="dv">11</span>]<span class="ot">=</span> survey_data[,<span class="dv">11</span>]<span class="sc">*</span><span class="dv">52</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert your now yearly emission reductions from kg to MT</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>survey_data[,<span class="dv">11</span>]<span class="ot">=</span> survey_data[,<span class="dv">11</span>]<span class="sc">*</span><span class="fl">0.001</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#____________ Sample Buyback vehicles based on variable probabilities ______________</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># sampling vehicles in buyback program by vehicle type probability</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="do">#### size = 108 = average of quotas for all three vehicles = mean (c(125,90,111))</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="do">#### Put the sample function within the forloop in order to do monte carlo iterations while you sample the amount of cars we can buy back with $500,000 budget</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>MTCO2_reduced_allvehicles<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (car <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#this line samples 108 vehicles from the 3196 population available (from access input file)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  sample_vehicles<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x =</span> survey_data<span class="sc">$</span>ID, <span class="at">size =</span> buyback_sample_size , <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">prob =</span> (survey_data[,<span class="dv">6</span>]))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line connects the survey data (info about reductions) with the ID of the records you sampled</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  join_vehicle_type<span class="ot">&lt;-</span>survey_data[survey_data<span class="sc">$</span>ID <span class="sc">%in%</span> sample_vehicles,]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line sums the emission reductions from all samples</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  MTCO2_reduced_allvehicles[car,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_vehicle_type[,<span class="dv">11</span>])</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line divides the cost of vehicles by the sum of emission reductions ($/MT reduced annually)</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  MTCO2_reduced_allvehicles[car,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">11</span>]))</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(MTCO2_reduced_allvehicles[,<span class="dv">1</span>])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(MTCO2_reduced_allvehicles[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(MTCO2_reduced_allvehicles[,<span class="dv">2</span>])</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(MTCO2_reduced_allvehicles[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">#sampling specific vehicles now to see if there are more emission reductions: SEDAN</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>sedans<span class="ot">&lt;-</span><span class="fu">subset</span>(survey_data, survey_data<span class="sc">$</span>VehicleType<span class="sc">==</span><span class="st">"Sedan"</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>emission.reduced.sedans<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps) {</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  sedan.vehicles<span class="ot">&lt;-</span><span class="fu">sample</span>(sedans<span class="sc">$</span>ID,<span class="dv">125</span>,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  Buyback.sedans<span class="ot">&lt;-</span>sedans[sedans<span class="sc">$</span>ID <span class="sc">%in%</span> sedan.vehicles,]</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  emission.reduced.sedans[s,<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="fu">sum</span>(Buyback.sedans<span class="sc">$</span>Total_Week_EmissionReduction_kgCO2)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line divides the cost of vehicles by the sum of emission reductions ($/MT reduced annually)</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  emission.reduced.sedans[s,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">11</span>]))</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval - SEDANS</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.sedans[,<span class="dv">1</span>])</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.sedans[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval - SEDANS</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.sedans[,<span class="dv">2</span>])</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.sedans[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co">#sampling specific vehicles now to see if there are more emission reductions: TRUCK</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>trucks<span class="ot">&lt;-</span><span class="fu">subset</span>(survey_data, survey_data<span class="sc">$</span>VehicleType<span class="sc">==</span><span class="st">"Truck"</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>emission.reduced.trucks<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps) {</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  truck.vehicles<span class="ot">&lt;-</span><span class="fu">sample</span>(trucks<span class="sc">$</span>ID,<span class="dv">111</span>,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  Buyback.trucks<span class="ot">&lt;-</span>trucks[trucks<span class="sc">$</span>ID <span class="sc">%in%</span> truck.vehicles,]</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  emission.reduced.trucks[t,<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="fu">sum</span>(Buyback.trucks<span class="sc">$</span>Total_Week_EmissionReduction_kgCO2)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line divides the cost of vehicles by the sum of emission reductions ($/MT reduced annually)</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  emission.reduced.trucks[t,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">11</span>]))</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval - TRUCKS</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.trucks[,<span class="dv">1</span>])</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.trucks[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval - TRUCKS</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.trucks[,<span class="dv">2</span>])</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.trucks[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co">#sampling specific vehicles now to see if there are more emission reductions: SUV</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>SUVs<span class="ot">&lt;-</span><span class="fu">subset</span>(survey_data, survey_data<span class="sc">$</span>VehicleType<span class="sc">==</span><span class="st">"SUV"</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>emission.reduced.SUV<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps) {</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  SUV.vehicles<span class="ot">&lt;-</span><span class="fu">sample</span>(SUVs<span class="sc">$</span>ID,<span class="dv">125</span>,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>  Buyback.SUV<span class="ot">&lt;-</span>SUVs[SUVs<span class="sc">$</span>ID <span class="sc">%in%</span> SUV.vehicles,]</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  emission.reduced.SUV[v,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(Buyback.SUV<span class="sc">$</span>Total_Week_EmissionReduction_kgCO2)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line divides the cost of vehicles by the sum of emission reductions ($/MT reduced annually)</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  emission.reduced.SUV[v,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_vehicle_type[,<span class="dv">11</span>]))</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval - SUV</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.SUV[,<span class="dv">1</span>])</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.SUV[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval - SUV</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(emission.reduced.SUV[,<span class="dv">1</span>])</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(emission.reduced.SUV[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co"># sampling vehicles in buyback program by age probability</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_age<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (car <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  vehicle_age_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x =</span> survey_data<span class="sc">$</span>ID, <span class="at">size =</span> buyback_sample_size , <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">prob =</span> (survey_data[,<span class="dv">7</span>]))</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  join_age<span class="ot">&lt;-</span>survey_data[survey_data<span class="sc">$</span>ID <span class="sc">%in%</span> vehicle_age_sample,]</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_age[car,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_age[,<span class="dv">11</span>])</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_age[car,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_age[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_age[,<span class="dv">11</span>]))</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_age[,<span class="dv">1</span>])</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_age[,<span class="dv">1</span>], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_age[,<span class="dv">2</span>])</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_age[,<span class="dv">2</span>], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a><span class="co"># sampling vehicles in buyback program by education probability</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_edu<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (car <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  vehicle_edu_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x =</span> survey_data<span class="sc">$</span>ID, <span class="at">size =</span> buyback_sample_size , <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">prob =</span> (survey_data[,<span class="dv">9</span>]))</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  join_edu<span class="ot">&lt;-</span>survey_data[survey_data<span class="sc">$</span>ID <span class="sc">%in%</span> vehicle_edu_sample,]</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_edu[car,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_edu[,<span class="dv">11</span>])</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_edu[car,<span class="dv">2</span>]<span class="ot">&lt;-</span>(<span class="fu">sum</span>(join_edu[,<span class="dv">10</span>]))<span class="sc">/</span>(<span class="fu">sum</span>(join_edu[,<span class="dv">11</span>]))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate emissions reduced mean and confidence interval</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_edu[,<span class="dv">1</span>])</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_edu[,<span class="dv">1</span>], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_edu[,<span class="dv">2</span>])</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_edu[,<span class="dv">2</span>], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="r-script-to-assess-policy-option-2" class="level3">
<h3 class="anchored" data-anchor-id="r-script-to-assess-policy-option-2">R Script to assess policy option 2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up dsata frame with business data and propoabilities of employees staying home, and how many already telework</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Note: 100 businesses can participate in program given the $5,000 incentive with the $500,000 budget</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>nreps<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>iseed<span class="ot">=</span><span class="dv">1234</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(iseed)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>smallbus<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"ID"</span><span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11503</span>, <span class="st">"Type"</span><span class="ot">=</span><span class="st">"S"</span>, <span class="st">"Min"</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"Max"</span><span class="ot">=</span><span class="dv">10</span>, <span class="st">"PropTC"</span><span class="ot">=</span><span class="fl">0.09</span>, <span class="st">"ProbPart"</span><span class="ot">=</span><span class="fl">0.09</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>medbus<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"ID"</span><span class="ot">=</span> <span class="dv">11504</span><span class="sc">:</span><span class="dv">15157</span>, <span class="st">"Type"</span><span class="ot">=</span><span class="st">"M"</span>, <span class="st">"Min"</span><span class="ot">=</span><span class="dv">11</span>, <span class="st">"Max"</span><span class="ot">=</span><span class="dv">30</span>, <span class="st">"PropTC"</span><span class="ot">=</span><span class="fl">0.031</span>, <span class="st">"ProbPart"</span><span class="ot">=</span><span class="fl">0.12</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>largebus<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"ID"</span><span class="ot">=</span> <span class="dv">15157</span><span class="sc">:</span><span class="dv">15660</span>, <span class="st">"Type"</span><span class="ot">=</span><span class="st">"L"</span>, <span class="st">"Min"</span><span class="ot">=</span><span class="dv">31</span>, <span class="st">"Max"</span><span class="ot">=</span><span class="dv">50</span>, <span class="st">"PropTC"</span><span class="ot">=</span><span class="fl">0.064</span>, <span class="st">"ProbPart"</span><span class="ot">=</span><span class="fl">0.17</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>businesses_data<span class="ot">&lt;-</span><span class="fu">rbind</span>(smallbus,medbus,largebus)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#import emissions  (contains weekly emissions, and emission reductions from not communting to work 2-5 days)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>Work_commute_data<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="at">file=</span> <span class="st">"GreenBusinessData.csv"</span> , <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">fill=</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Covert the weekly emission reductions to annual</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>Work_commute_data[,<span class="dv">8</span>]<span class="ot">=</span> Work_commute_data[,<span class="dv">8</span>]<span class="sc">*</span><span class="dv">52</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert your now yearly emission reductions from kg to MT</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>Work_commute_data[,<span class="dv">8</span>]<span class="ot">=</span> Work_commute_data[,<span class="dv">8</span>]<span class="sc">*</span><span class="fl">0.001</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Randomly select businesses and determine # of additional employees that will telework in a nested forloop to sample </span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>Selected_Businesses<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">100</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>Selected_employees<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">100</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>people<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps) {</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  Businesses<span class="ot">&lt;-</span><span class="fu">sample</span>(businesses_data<span class="sc">$</span>ID, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> F, <span class="at">prob =</span> businesses_data<span class="sc">$</span>probPart)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  join<span class="ot">&lt;-</span>businesses_data[businesses_data<span class="sc">$</span>ID <span class="sc">%in%</span> Businesses,]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    Selected_Businesses[b,]<span class="ot">&lt;-</span><span class="fu">sample</span>(join[b,<span class="dv">3</span>]<span class="sc">:</span>join[b,<span class="dv">4</span>], <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    Selected_employees<span class="ot">&lt;-</span>Selected_Businesses<span class="sc">-</span>join[b,<span class="dv">5</span>]<span class="sc">*</span>Selected_Businesses</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    Selected_employees<span class="ot">&lt;-</span><span class="fu">round</span>(Selected_employees)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  people[a,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(Selected_employees)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Make for loop like the ones from the buy back program, sample telecomuting emissions$ID, sample size is the people selected in the nested forloop above</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Sample for 2 days of working remotely</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_2days<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  people_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x=</span>Work_commute_data<span class="sc">$</span>ID, <span class="at">size =</span> Selected_employees[t,], <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  join_emissions<span class="ot">&lt;-</span>Work_commute_data[Work_commute_data<span class="sc">$</span>ID <span class="sc">%in%</span> people_sample,]</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_2days[t,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_emissions[,<span class="dv">9</span>])</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_2days[t,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">500000</span><span class="sc">/</span><span class="fu">sum</span>(join_emissions[,<span class="dv">9</span>])</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 2day emissions reduced mean and confidence interval</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_2days[,<span class="dv">1</span>])</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_2days[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_2days[,<span class="dv">2</span>])</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_2days[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="do">### Sample for 3 days of working remotely</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_3days<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  people_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x=</span>Work_commute_data<span class="sc">$</span>ID, <span class="at">size =</span> Selected_employees[t,], <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  join_emissions<span class="ot">&lt;-</span>Work_commute_data[Work_commute_data<span class="sc">$</span>ID <span class="sc">%in%</span> people_sample,]</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_3days[t,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_emissions[,<span class="dv">10</span>])</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_3days[t,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">500000</span><span class="sc">/</span><span class="fu">sum</span>(join_emissions[,<span class="dv">10</span>])</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 3day emissions reduced mean and confidence interval</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_3days[,<span class="dv">1</span>])</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_3days[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_3days[,<span class="dv">2</span>])</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_3days[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="do">### Sample for 4 days of working remotely</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_4days<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  people_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x=</span>Work_commute_data<span class="sc">$</span>ID, <span class="at">size =</span> Selected_employees[t,], <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  join_emissions<span class="ot">&lt;-</span>Work_commute_data[Work_commute_data<span class="sc">$</span>ID <span class="sc">%in%</span> people_sample,]</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_4days[t,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_emissions[,<span class="dv">11</span>])</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_4days[t,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">500000</span><span class="sc">/</span><span class="fu">sum</span>(join_emissions[,<span class="dv">11</span>])</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 4day emissions reduced mean and confidence interval</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_4days[,<span class="dv">1</span>])</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_4days[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_4days[,<span class="dv">2</span>])</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_4days[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="do">### Sample for 5 days of working remotely</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>Emissions_reduced_5days<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> nreps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nreps)) {</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  people_sample<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="at">x=</span>Work_commute_data<span class="sc">$</span>ID, <span class="at">size =</span> Selected_employees[t,], <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  join_emissions<span class="ot">&lt;-</span>Work_commute_data[Work_commute_data<span class="sc">$</span>ID <span class="sc">%in%</span> people_sample,]</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_5days[t,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(join_emissions[,<span class="dv">12</span>])</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  Emissions_reduced_5days[t,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="dv">500000</span><span class="sc">/</span><span class="fu">sum</span>(join_emissions[,<span class="dv">12</span>])</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 5day emissions reduced mean and confidence interval</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_5days[,<span class="dv">1</span>])</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_5days[,<span class="dv">1</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate $/MT emissions reduced mean and confidence interval</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Emissions_reduced_5days[,<span class="dv">2</span>])</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Emissions_reduced_5days[,<span class="dv">2</span>], <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>